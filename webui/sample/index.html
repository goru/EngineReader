<!DOCTYPE html>
<html>

  <head>
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/bootstrap-responsive.css" rel="stylesheet">

    <script type="text/javascript">
      function loadEntries(id) {
        $.getJSON('/api/feeds/' + id + '/unread', function(json) {
          for(var i in json.entries) {
            var entry = json.entries[i];

            $('#' + id).append('<div class="span12" id="wrap-' + entry.id + '"></div>');

            $('#wrap-' + entry.id).append('<h4><a id="title-' + entry.id
              + '" href="javascript:void(0);" link="' + entry.url
              + '" feed="' + id + '" entry="' + entry.id + '">'
              + entry.title + '</a></h4>');
            $('#wrap-' + entry.id).append('<blockquote id="desc-'+ entry.id
              + '" feed="' + id + '" entry="' + entry.id + '">'
              + entry.description + '</blockquote>');
            $('#wrap-' + entry.id).append('<div class="row">'
              + '<div class="span2 offset10"><p class="text-right">'
              + '<button type="button" class="btn btn-primary" data-toggle="button" '
              + 'id="button-'+ entry.id + '" feed="' + id + '" entry="' + entry.id + '">'
              + '<i class="icon-ok icon-white"></i> Read</button>'
              + '</p></div></div>');

            $('#title-' + entry.id).click(function() {
              var feedId = $(this).attr('feed');
              var entryId = $(this).attr('entry');
              var url = $(this).attr('link');

              window.open(url);
              $.post('/api/feeds/' + feedId + '/' + entryId + '/read');
            });

            $('#button-' + entry.id).click(function() {
              var feedId = $(this).attr('feed');
              var entryId = $(this).attr('entry');

              if ($(this).hasClass('active')) {
                $.post('/api/feeds/' + feedId + '/' + entryId + '/unread');
              } else {
                $.post('/api/feeds/' + feedId + '/' + entryId + '/read');
              }
            });
          }
        });
      }

      $(function() {
        $('#header').html('<div class="alert alert-info">now loading...</div>');
        $.getJSON('/api/feeds/', function(json) {
          for(var i in json.feeds) {
            var feed = json.feeds[i];

            $('#body').append('<div class="span12"><h3>' + feed.title
              + '</h3><div class="row" id="' + feed.id + '"></div></div>');

            loadEntries(feed.id);
          }

          $('#header').html('');
        });
      });
    </script>

    <style type="text/css">
      #padding-for-navbar {
        padding-top: 40px;
      }
    </style>

  </head>

  <body>
    <div class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
        <div class='container'>
          <ul class="nav">
            <li class="active"><a href="/"><i class="icon-home icon-white"></i> Home</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class='container visible-desktop' id='padding-for-navbar'></div>

    <div class='container'>
      <div class='row' id='header'></div>
      <div class='row' id='body'></div>
      <div class='row' id='footer'></div>
    </div>
  </body>

</html>
